<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: index.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: index.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @requires lib/utils/licenses
 * @requires lib/utils/modules
 */

'use strict';

var licenseChecker = require('license-checker');
var licenses = require('./utils/licenses.js');
var modules = require('./utils/modules.js');
var noop = require('lodash.noop');

/**
 * Map license-checker result.
 * @private
 *
 * @param {string} key &lt;name>@&lt;version>
 * @param {object} data
 * @returns {object}
 */
function mapLicenseCheckerResult(key, data) {
    var keyPieces = key.split('@');
    var licenses = data.licenses;

    if (keyPieces.length &lt; 2) {
        throw new Error(
            'Key doesn\'t match expected &lt;name>@&lt;version> format: ' + key
        );
    }

    /**
     * license-checker appends '*' to licenses when it's making assumptions
     * based on string comparisions. We'll accept the assumptions as valid
     * licenses.
     */
    if (licenses.slice(-1) === '*') {
        licenses = licenses.slice(0, licenses.length - 1);
    }

    return {
        licenses: licenses,
        licenseFile: data.licenseFile,
        name: keyPieces[0],
        repository: data.repository,
        version: keyPieces[1],
    };
}

/**
 * Check.
 * {@link https://github.com/davglass/license-checker#requiring}
 * @module module:licenz
 *
 * @param {object} options
 * @param {string} [options.path=process.cwd()] Path to begin license search. It should _package.json_ and _node_modules_. Defaults to the current directory.
 * @param {array} [options.whitelistLicenses]
 * @param {object} [options.whitelistModules]
 * @param {checkCallback} [callback=noop] Callback fired after all licenses have been scanned.
 * @return {Promise}
 */
function check(options, callback) {
    callback = callback instanceof Function ? callback : noop;

    var path = options.path || process.cwd();
    var whitelistLicenses = options.whitelistLicenses;
    var whitelistModules = options.whitelistModules;

    if (whitelistModules) {
        modules.whitelist(whitelistModules);
    }
    if (whitelistLicenses) {
        licenses.whitelist(whitelistLicenses);
    }

    return new Promise(function(resolve, reject) {
        licenseChecker.init({
            start: path,
        }, function(json, err) {
            if (err) {
                callback(err);
                reject(err);
                return;
            }

            var results = Object.keys(json)
                .map(function(key) {
                    return mapLicenseCheckerResult(key, json[key]);
                })
                .filter(function(module) {
                    // license-checker sometimes emits 'undefined' results
                    if (
                        module.name === 'undefined' &amp;&amp;
                        module.version === 'undefined'
                    ) {
                        return;
                    }

                    return !(
                        licenses.isPermitted(module.licenses) ||
                        modules.isPermitted(module.name, module.version)
                    );
                });

            callback(null, results);
            resolve(results);
        });
    });
}

/**
 * @callback checkCallback
 * @param {Error} err
 * @param {array} res
 */

module.exports = check;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-lib_utils_licenses.html">lib/utils/licenses</a></li><li><a href="module-lib_utils_modules.html">lib/utils/modules</a></li><li><a href="module-licenz.html">licenz</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Fri Jan 22 2016 11:10:29 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
